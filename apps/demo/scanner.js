/* globals cpcBasic */

"use strict";

cpcBasic.addItem("", function () { /*
1 rem scanner - The Scannerisator
2 rem (c) 3 Pouces Mag, 1990
3 rem https://www.cpc-power.com/index.php?page=detail&num=12148
4 rem see also: https://www.cpcwiki.eu/forum/software-related/6128-plus-basic-problem/
5 rem Modifications: files renamed; decode in BASIC
6 rem
10 on error goto 11:openin "scanner1.zip":closein:goto 12:'cpcBasic: extract files from archive
11 resume 12
12 on error goto 0
13 MEMORY &5FFF:MODE 1:BORDER 0:INK 0,0:INK 1,25:LOAD"SCAN00P1":gosub 3000:'CALL &6000  
18 A=&2000:F=&2061:L=100:WHILE A<=F:FOR A=A TO A+15:READ C$:K=VAL("&"+C$):S=S+K+65536*(S+K>32767):IF A<=F THEN POKE A,K
20 NEXT:READ D$:T=VAL("&"+D$):IF T<>S THEN PRINT CHR$(7);"Erreur ligne";L:END ELSE L=L+5:WEND
30 CALL &2000
40 DATA 3E,C9,32,38,00,21,47,20,06,38,10,FE,01,01,7F,ED,04B3
50 DATA 49,7E,FE,FF,28,EF,23,CB,F7,ED,79,01,0E,F4,ED,49,0E12
60 DATA 01,C0,F6,ED,49,01,92,F7,ED,49,01,45,F6,ED,49,06,1637
70 DATA F4,ED,78,01,82,F7,ED,49,01,09,F6,ED,49,17,DA,0C,1E73
80 DATA 20,3E,C3,32,38,00,C9,1C,18,1D,0C,05,0D,16,06,17,2169
90 DATA 1E,00,1F,0E,07,0F,12,02,13,1A,19,1B,0A,03,0B,FF,2356
100 DATA 00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,2356
110 LOAD"SCAN00P2":call &bb18:MODE 2:gosub 3000: 'CALL &6000
115 BORDER 25
116 MEMORY &8813:LOAD"SCAN00M1":CALL &8814:WHILE INKEY(47):CALL &88A3:CALL &BD19:WEND :'MUSIQUE1
120 SOUND 1,220,12,1:MEMORY &5FFF:INK 1,26
124 LOAD"SCAN00P3":CALL &BB18:gosub 3000:INK 1,26:'CALL &6000
125 BORDER 0:INK 1,0:INK 0,26:
130 LOAD"SCAN01":CALL &BB18:BORDER 26:gosub 3000:'CALL &6000
132 LOAD"SCAN02":CALL &BB18:gosub 3000:'CALL &6000
134 LOAD"SCAN03":CALL &BB18:gosub 3000:'CALL &6000
136 LOAD"SCAN04":CALL &BB18:gosub 3000:'CALL &6000
138 LOAD"SCAN05":CALL &BB18:gosub 3000:'CALL &6000
140 LOAD"SCAN06":CALL &BB18:gosub 3000:'CALL &6000
142 LOAD"SCAN07":CALL &BB18:gosub 3000:'CALL &6000
144 LOAD"SCAN08":CALL &BB18:gosub 3000:'CALL &6000
146 LOAD"SCAN09":CALL &BB18:gosub 3000:'CALL &6000
150 LOAD"SCAN10":CALL &BB18:gosub 3000:'CALL &6000
152 LOAD"SCAN11":CALL &BB18:gosub 3000:'CALL &6000
160 LOAD"SCAN12":CALL &BB18:gosub 3000:'CALL &6000
162 LOAD"SCAN13":CALL &BB18:gosub 3000:'CALL &6000
164 LOAD"SCAN14":CALL &BB18:gosub 3000:'CALL &6000
170 LOAD"SCAN14TO":CALL &BB18:gosub 3000:'CALL &6000 'TOURNE
171 MEMORY &1FFF:LOAD"SCAN14M2":CALL &BCA7 :'MUSIQUE2
172 POKE &2595,14:CALL &2594: 'GOSUB 174
174 WHILE INKEY$="":CALL &264B:CALL &BD19:WEND:CALL &BCA7
175 MEMORY &5FFF
176 LOAD"SCAN15":CALL &BB18:gosub 3000:'CALL &6000
177 LOAD"SCAN16":CALL &BB18:gosub 3000:'CALL &6000
178 LOAD"SCAN17":CALL &BB18:gosub 3000:'CALL &6000
180 LOAD"SCAN18":CALL &BB18:gosub 3000:'CALL &6000
181 LOAD"SCAN19":CALL &BB18:gosub 3000:'CALL &6000
182 LOAD"SCAN20":CALL &BB18:gosub 3000:'CALL &6000
185 LOAD"SCAN21":CALL &BB18:gosub 3000:'CALL &6000
186 LOAD"SCAN22":CALL &BB18:gosub 3000:'CALL &6000
187 LOAD"SCAN23":CALL &BB18:gosub 3000:'CALL &6000
190 LOAD"SCAN24":CALL &BB18:gosub 3000:'CALL &6000
191 LOAD"SCAN25":CALL &BB18:gosub 3000:'CALL &6000
192 LOAD"SCAN26":CALL &BB18:gosub 3000:'CALL &6000
195 MEMORY &6E9E:LOAD"SCAN26M3":CALL &6E9F:WHILE INKEY$="":CALL &6F76:CALL &BD19:WEND 'MUSIQUE3
200 SOUND 1,222,12,1:MEMORY &5FFF:INK 1,0:BORDER 0
205 LOAD"SCAN27FI":CALL &BB18:INK 1,0:BORDER 0:gosub 3000:'CALL &6000  FIN 
210 call &bb18:stop:'GOTO 210
2980 '
2990 'decompress
3000 c.s=&6040:c.d=&c000
3010 while c.d<>0
3020 if peek(c.s)<>&6e then 3073 else if peek(c.s+1)<>&86 then 3073
3030 c.s=c.s+2
3040 c.by=peek(c.s):c.cnt=peek(c.s+1):c.s=c.s+2
3050 for c.i=1 to c.cnt
3060 poke c.d,c.by:c.d=c.d+1
3070 next
3071 goto 3080
3072 '
3073 poke c.d,peek(c.s)
3074 c.s=c.s+1
3075 c.d=c.d+1
3080 wend
3090 return
3100 '
*/ });
