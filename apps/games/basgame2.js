/* globals cpcBasic */

"use strict";

cpcBasic.addItem("", function () { /*
1 rem basgame2 - BASIC Game 2
2 rem (c) Roald (Mr.Lou) Strauss
3 rem https://www.cpcwiki.eu/forum/programming/another-unfinished-basic-game-project/
4 rem adapted by AMSDOS, mv
5 rem 
100 KEY 0,"ink 0,11:border 11:ink 1,26:pen 1:paper 0:mode 2"+CHR$(13)
110 ENV 1,15,-1,1:ENV 2,15,-1,5:ENT 2,40,2,1:ENV 3,15,-1,10:ENT 3,100,2,2:ENV 4,15,1,1:ENT 4,100,-5,1
120 SYMBOL 249,0,0,0,0,0,0,56,0
130 SYMBOL 250,16,16,56,108,108,254,198,130
140 SYMBOL 251,16,32,32,16,8,8,16,16
150 SYMBOL 252,170,0,0,0,0,0,0,0
160 SYMBOL 253,173,154,170,164,84,72,40,16
170 SYMBOL 254,8,4,4,8,16,16,8,8
180 SYMBOL 255,16,16,16,16,16,16,16,16
190 PAPER 0:INK 0,1:BORDER 0:INK 1,22:INK 2,25:INK 3,15,24:SPEED INK 3,3
200 MODE 1
205 WINDOW#1,34,40,1,25:PEN#1,2
210 RANDOMIZE TIME:DEFINT a-z:DIM e(31)
250 x=15:y=23:c=1:f=1:s=12:l=2
260 PEN 1
265 s$=CHR$(250)+CHR$(22)+CHR$(1)+CHR$(8)+CHR$(15)+CHR$(3)+CHR$(249)+CHR$(22)+CHR$(2)
270 FOR n=0 TO 31
275   e(n)=1
280   SOUND 1,1000-n*10,1,15,1
290   LOCATE n+1,e(n):PEN 1:PRINT CHR$(253);
300   LOCATE n+1,21:PEN 2:PRINT CHR$(252);
310 NEXT
315 r=INT(RND*32):b=29:GOSUB 1000
320 LOCATE x+1,y:PEN 2:PRINT s$;
330 FOR c=1 TO 16384
335   t!=TIME
350   j=JOY(0)
352   IF j AND 12 THEN LOCATE x+1,y:x=(x+((j AND 4)>0)-((j AND 8)>0)) AND 31:PEN 2:PRINT " ";:LOCATE x+1,y:PRINT s$;
360   IF (j AND 16) AND (b>0) THEN GOSUB 450 ELSE LOCATE#1,1,5:PRINT#1,c
370   IF (j AND 32) OR INKEY(47)=0 THEN GOSUB 620 ELSE f=1
380   IF (c MOD s)=0 THEN GOSUB 570
390   IF (c MOD l)=0 THEN l=l*2:s=s-1:IF s=0 THEN s=1
400   IF p=x THEN GOSUB 1000
406   IF TIME-t!<18 THEN CALL &BD19:GOTO 406
410 NEXT c
412 GOTO 330
425 '
448 'Fire
450 SOUND 2,10,10,15,2,2,1
460 a=e(x)-INT(b/50):IF a<2 THEN a=2
470 LOCATE x+1,e(x)+1:c1=32:n2=1:GOSUB 975:PEN 3
480 c1=251:n2=e(x)-a+1:GOSUB 975:CALL &BD19
500 GOSUB 570:LOCATE x+1,e(x)
510 c1=32:n2=e(x)-a:GOSUB 975:'call &bd19
530 e(x)=a-1
540 b=b-1:GOTO 1015
545 '
570 FOR d=1 TO 2
580  r=INT(RND*32):e(r)=e(r)+1:LOCATE r+1,e(r):PEN 1:PRINT CHR$(254);:IF e(r)=20 THEN 980
590 NEXT
600 SOUND 4,INT(RND*500)+200,10,15,1
610 RETURN
615 '
617 'Bomb
620 IF f THEN f=0 ELSE RETURN
630 IF b<10 THEN RETURN
640 SOUND 2,10,50,15,3,3,15:PEN 3
650 c1=251
655 z=x:n2=e(z):GOSUB 973
670 z=(x-1) AND 31:n2=e(z)-1:GOSUB 973
700 z=(x+1) AND 31:n2=e(z)-1:GOSUB 973
740 z=x:n2=e(z)-1:c1=32:GOSUB 973:c1=251
770 e(x)=1
775 z=(x-2) AND 31:n2=e(z)-2:GOSUB 973
800 z=(x+2) AND 31:n2=e(z)-2:GOSUB 973
840 z=(x-1) AND 31:n2=e(z)-2:c1=32:GOSUB 973
870 e(z)=1:z=(x+1) AND 31:n2=e(z)-2:GOSUB 973
900 e(z)=1:z=(x-2) AND 31:n2=e(z)-3:GOSUB 973
930 e(z)=1:z=(x+2) AND 31:n2=e(z)-3:GOSUB 973
960 e(z)=1
970 b=b-10:GOTO 1015
972 '
973 LOCATE z+1,e(z)+1:GOSUB 975:CALL &BD19:RETURN
974 '
975 FOR n=1 TO n2:PRINT CHR$(c1);CHR$(8);CHR$(11);:NEXT:RETURN
977 '
980 PRINT "Dead"
985 WHILE INKEY$<>"":CALL &BD19:WEND
990 END
995 '
997 'New powerup position
1000 SOUND 1,478,50,5,4,4:p=INT(RND*32)
1010 b=b+5:GOTO 1015 
1015 LOCATE#1,1,1:PRINT#1,b:RETURN 
1200 REM
1210 REM controls:
1220 REM joy left, right
1230 REM joy fire: shot
1240 REM joy fire or space: bomb
1250 REM
1290 REM variables:
1295 REM a   rangeto
1300 REM b   bullets
1305 REM c   counter (points?)
1310 REM e() enemypos(0..31)
1315 REM f   flag (bomb key active)
1320 REM l   levelchange
1325 REM p   powerup position
1330 REM s   level
1340 REM x   xpos ship
1350 REM y   ypos ship
1360 REM
*/ });
