/* globals cpcBasic */

"use strict";

cpcBasic.addItem("", function () { /*
1 rem duel - Duel (Duell)
2 rem (c) Bernhard Morell
3 rem 
5 rem Modification: replaced MC by BASIC; check key during sound
6 rem
10 MODE 1:INK 0,24:INK 1,0:INK 2,9:INK 3,16:BORDER 24:PAPER 0
20 WINDOW #1,1,40,1,3:WINDOW#2,1,40,4,25:PAPER #1,1:PEN #1,0
25 window #3,5+1,7+1,3+1,23+1:window #4,&1d+1,&1f+1,3+1,&17+1
30 CLS#1
40 SYMBOL AFTER 180
50 SYMBOL 180,255,0,0,255,16,16,16,239
60 SYMBOL 181,187,68,68,199,4,4,4,251
70 SYMBOL 182,247,8,8,255,255,33,33,222
80 SYMBOL 200,108,146,146,69,161,138,100,24
90 GOSUB 610
100 GOSUB 430:GOSUB 470:GOSUB 720:GOSUB 580
110 call &bd19:GOSUB 510
120 IF RND<0.5 THEN 140 ELSE 130
130 IF INKEY(77)>-1 OR INKEY(76)>-1 THEN GOSUB 290:GOTO 150 
140 IF INKEY(53)>-1 OR INKEY(52)>-1 OR INKEY(9)>-1 THEN GOSUB 360:GOTO 150 
150 IF pu1>10 OR pu2>10 THEN GOTO 160 ELSE 110
160 IF pu2>10 THEN 190
170 LOCATE 1,23:PRINT n1$;" hat das Duell gewonnen "
180 LOCATE 1,25:PRINT n1$;"[ neues Spiel ?  J/N ]":ta$=INKEY$:IF ta$="" THEN 180 ELSE ta$=UPPER$(ta$):IF ta$="J" THEN CLEAR:GOTO 10 ELSE IF ta$="N" THEN PAPER 0:PEN 1:BORDER 0:ink 1,24:ink 0,0:CLS:GOSUB 890:END ELSE 180 
190 LOCATE 1,23:PRINT n2$;" hat das Duell gewonnen "
200 GOTO 180
210 FOR i=1 TO 25: gosub 2040 'CALL 40015
220 NEXT i
230 pu1=pu1+1:LOCATE #1,10,3:PRINT#1,pu1
240 GOSUB 470:RETURN
250 FOR i=1 TO 25: gosub 2010 'CALL 40000
260 NEXT i 
270 pu2=pu2+1:LOCATE #1,30,3:PRINT#1,pu2
280 GOSUB 430:RETURN 
290 IF r1<0 THEN y1a=y1-5 ELSE IF r1>0 THEN y1a=y1+5 ELSE y1a=y1-1
300 IF y1a>25 THEN y1a=25 ELSE IF y1a<5 THEN y1a=5
310 IF TEST(27*16-4,404-y1a*16)<>0 THEN LOCATE 27,y1a:PRINT CHR$(200):GOSUB 870:LOCATE 27,y1a:PRINT" ":RETURN
320 IF TEST(28*16-4,404-y1a*16)<>0 THEN LOCATE 28,y1a:PRINT CHR$(200):GOSUB 870:LOCATE 28,y1a:PRINT" ":RETURN 
330 IF TEST(29*16-4,404-y1a*16)<>0 THEN LOCATE 29,y1a:PRINT CHR$(200):GOSUB 870:LOCATE 29,y1a:PRINT" ":RETURN 
340 IF TEST(496,404-y1a*16)<>0 THEN LOCATE 31,y1a:PRINT CHR$(200):GOSUB 870:GOSUB 880:GOSUB 210:FOR i=1 TO 5:GOSUB 510:NEXT i:RETURN
350 LOCATE 29,y1a:PRINT CHR$(200):GOSUB 870:LOCATE 29,y1a:PRINT" ":RETURN 
360 IF r2<0 THEN y2a=y2-5 ELSE IF r2>0 THEN y2a=y2+5 ELSE y2a=y2-1 
370 IF y2a>25 THEN y2a=25 ELSE IF y2a<5 THEN y2a=5 
380 IF TEST(11*16-4,404-y2a*16)<>0 THEN LOCATE 11,y2a:PRINT CHR$(200):GOSUB 870:LOCATE 11,y2a:PRINT" ":RETURN 
390 IF TEST(10*16-4,404-y2a*16)<>0 THEN LOCATE 10,y2a:PRINT CHR$(200):GOSUB 870:LOCATE 10,y2a:PRINT" ":RETURN  
400 IF TEST(9*16-4,404-y2a*16)<>0 THEN LOCATE 9,y2a:PRINT CHR$(200):GOSUB 870:LOCATE 9,y2a:PRINT" ":RETURN
410 IF TEST(98,404-y2a*16)<>0 THEN LOCATE 7,y2a:PRINT CHR$(200):GOSUB 870:GOSUB 880:GOSUB 250:FOR i=1 TO 5:GOSUB 510:NEXT i:RETURN 
420 LOCATE 9,y2a:PRINT CHR$(200):GOSUB 870:LOCATE 9,y2a:PRINT" ":RETURN 
430 RESTORE 770:MOVE 90,100:y1=19 
440 FOR i=1 TO 127 
450 READ z1,z2,z3:PLOTR z1,z2,z3
460 NEXT i:GOSUB 890:RETURN
470 RESTORE 810:MOVE 490,100:y2=19  
480 FOR i=1 TO 142
490 READ z1,z2,z3:PLOTR z1,z2,z3 
500 NEXT i:GOSUB 890:RETURN 
510 IF INKEY(72)>-1 AND y1>6 THEN y1=y1-1:POKE 40001,&1: gosub 2010 'CALL 40000
520 IF INKEY(0)>-1 AND y2>6 THEN y2=y2-1:POKE 40016,&1: gosub 2040 'CALL 40015
530 IF INKEY(2)>-1 AND y2<24 THEN y2=y2+1:POKE 40016,&0: gosub 2040 'CALL 40015
540 IF INKEY(73)>-1 AND y1<24 THEN y1=y1+1:POKE 40001,&0: gosub 2010 'CALL 40000
550 r1=0:r1=r1+(INKEY(72)>-1)-(INKEY(73)>-1)
560 r2=0:r2=r2+(INKEY(0)>-1)-(INKEY(2)>-1) 
570 RETURN
580 PAPER 3:FOR ii=1 TO 3 STEP 2:FOR i=7 TO 24
590 IF RND<0.2 THEN LOCATE 9*ii,i:PRINT CHR$(INT(RND*3)+180);CHR$(INT(RND*3)+180);CHR$(INT(RND*3)+180) ELSE IF RND<0.3 THEN LOCATE 9*ii,i:PRINT CHR$(INT(RND*3)+180);CHR$(INT(RND*3)+180) ELSE IF RND<0.4 THEN LOCATE 9*ii,i:PRINT CHR$(INT(RND*3)+180)
600 NEXT i,ii:PAPER 0:RETURN
610 PRINT#1,"   D U E L L   von   Bernhard   Morell":PEN #1,3
620 GOSUB 650:LOCATE #1,2,2:PRINT#1,"  ";n1$:LOCATE #1,22,2:PRINT#1,"  ";n2$
630 LOCATE #1,1,3:PRINT #1,"Punkte : ";pu1:LOCATE #1,20,3:PRINT#1,"Punkte : ";pu2
640 RETURN
650 LOCATE 3,10:PRINT"Dein Name ?":GOSUB 430:LOCATE 3,24:INPUT n1$
660 IF LEN(n1$)>10 THEN CLS #2:GOTO 650
670 LOCATE 23,10:PRINT"und Dein Name ?":GOSUB 470:LOCATE 23,24:INPUT n2$ 
680 IF LEN(n2$)>10 THEN CLS #2:GOTO 670 
690 CLS#2:RETURN
700 DATA &6,&1,&3e,&0,&21,&3,&5,&11,&17,&7,&cd,&50,&bc,&c9,&0
701 'LD B,&01:LD A,&00:LD HL,&0503:LD DE,&0717:CALL &BC50:RET 'software roll
710 DATA &6,&1,&3e,&0,&21,&3,&1d,&11,&17,&1f,&cd,&50,&bc,&c9,&0  
711 'LD B,&01:LD A,&00:LD HL,&1D03:LD DE,&1F17:CALL &BC50:RET 'software roll
720 RESTORE 700:FOR i=40000 TO 40014 
730 READ z:POKE i,z:NEXT i
740 RESTORE 710:FOR i=40015 TO 40029   
750 READ z:POKE i,z:NEXT i
760 RETURN
770 DATA 2,0,1,4,0,1,2,0,1,0,2,1,-2,0,1,-2,0,1,-2,0,1,0,2,1,2,0,1,-2,2,3,2,0,3,2,0,3,0,2,3,-2,0,3,-2,0,3,-2,0,3,0,2,3,2,0,3,2,0,3,2,                            0,3,2,0,3,0,2,1,-2,0,1,-2,0,1,-2,0,1,-2,0,3,0,2,1,2,0,2,2,0,2,2,0,2,2,0,2,2,0,2
780 DATA -10,2,2,2,0,2,2,0,2,2,0,2,2,0,1,2,0,1,2,0,1,2,0,1,2,0,3,2,0,1,0,2,3,6,2,1,-2,0,1,-2,0,1,-2,0,1,0,2,1,-2,-4,3,-2,0,1,-2,0,1,-2,0,1,-2,0,1,-2,0,1,-2,0,2,-2,0,2,-2,0,2,-2,2,2,2,0,2,2,0,1,2,0,1,2,0,2,2,2,1,-2,0,1,-2,0,1,-2,0,1,-2,0,2,-2,0,2,2,2,2
790 DATA 2,0,1,2,0,3,2,0,3,-6,2,1,2,0,3,2,0,3,2,0,3,4,0,3,2,0,3,-8,2,3,2,0,3,2,0,3,2,0,3,2,0,3,-2,2,3,-2,0,1,-2,0,3,-2,0,3,-2,0,1,-2,0,1,-2,0,1,-2,0,1,-2,0,1,0,2,1,4,0,1,2,0,1,2,0,1,2,0,1,2,0,3,2,0,3,2,0,3,-2,2,3,-2,0,1,-2,0,1,-2,0,0,-2,0,0
800 DATA 0,2,1,2,0,0,2,0,1,2,0,1,2,0,1,2,2,1,-2,0,1,-2,0,1,-2,0,0,-2,0,1,-2,0,1,-4,2,1,2,0,1,2,0,1,2,0,1,2,0,1,6,0,1,0,2,1,-8,0,1,-2,0,1,0,2,1
810 DATA 2,0,1,0,2,1,2,-2,1,2,0,1,2,0,1,4,2,1,-2,0,1,-2,0,2,-2,0,2,0,2,2,2,0,2,2,2,2,-2,0,2,-2,0,2,-2,0,2,-2,2,2,2,0,2,2,0,2,2,0,2,2,0,2,2,2,2,-2,0,2,-2,0,2,-2,0,2,-2,0,2,-2,0,2,-2,2,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,2,2,0,2
820 DATA 2,2,2,-2,0,2,-2,0,1,-2,0,3,-2,0,0,-2,0,3,-2,0,0,-2,0,3,-2,0,3,0,2,3,2,0,0,2,0,3,2,0,0,2,0,3,2,0,0,2,0,3,2,0,1,2,0,2,0,2,3,-2,0,3,-2,0,0,-2,0,3,-2,0,0,-2,0,3,-2,0,0,-2,0,3,2,2,3,2,0,0,2,0,3,2,0,0,2,0,3,2,0,0,2,0,3
830 DATA 0,2,3,-2,0,3,-2,0,0,-2,0,1,-2,0,1,-2,0,1,-2,0,1,-2,0,1,-2,0,1,-2,0,3,-2,0,1,-6,4,1,2,0,1,2,0,1,2,0,1,0,-2,3,2,0,3,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,3,0,2,1,-2,0,1,-2,0,1,-2,0,1,0,2,3,2,0,3,2,0,3,2,2,3,-2,0,3,-2,0,3,-2,0,3,-2,0,3
840 DATA -2,0,3,0,2,3,2,0,3,2,0,1,2,0,3,2,0,3,2,0,3,0,2,3,-2,0,3,-2,0,3,-2,0,3,-6,2,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,2,1,-2,0,1,-2,0,3,-2,0,3,-2,0,3,-2,0,3,-2,0,1,-2,0,1,-2,0,1,0,2,1,6,0,1,2,0,1,2,0,1,2,0,1,4,0,1,2,0,1,0,2,1,-8,0,1,-2,0,1
850 DATA -2,0,1
860 '========Geraeusche=========
870 SOUND 2,2000,15,15,,,15:FOR i=0 TO 500 STEP 30:SOUND 3,1+1,1+INT(i/160),12:NEXT:RETURN
880 FOR ii=0 TO 1000 STEP 200:FOR i=1 TO 500 STEP 15:SOUND 3,ii+i,1,12:NEXT i:NEXT ii:RETURN
890 '========Musik=========
900 SOUND 1,284,30,12:SOUND 1,213,20,12:SOUND 1,190,10,12:SOUND 1,169,10,12
910 SOUND 1,189,10,12:SOUND 1,159,30,12
920 SOUND 1,169,20,12:SOUND 1,190,10,12:SOUND 1,213,40,12:SOUND 1,2000,20,1
930 SOUND 1,284,30,12:SOUND 1,213,20,12:SOUND 1,190,10,12:SOUND 1,169,10,12
940 SOUND 1,189,10,12:SOUND 1,159,30,12 
945 'if inkey$<>"" then while inkey$<>"":wend:return:' not for duel
950 SOUND 1,169,20,12:SOUND 1,190,40,12:SOUND 1,2000,20,1 
960 SOUND 1,239,30,12:SOUND 1,179,20,12:SOUND 1,159,10,12:SOUND 1,142,20,12 
970 SOUND 1,159,10,12:SOUND 1,134,30,12 
980 SOUND 1,142,20,12:SOUND 1,159,10,12:SOUND 1,179,40,12:SOUND 1,2000,20,1 
990 SOUND 1,239,30,12:SOUND 1,179,20,12:SOUND 1,159,10,12:SOUND 1,142,20,12  
1000 SOUND 1,159,10,12:SOUND 1,134,30,12   
1010 SOUND 1,142,20,12:SOUND 1,159,40,12:RETURN
1990 '
2000 'simulate CALL 40000 software roll player 1 in BASIC
2010 if peek(40001)>0 then locate #3,1,21:print#3:print#3 else locate #3,1,1:print#3,chr$(11);chr$(11);
2020 return
2030 'simulate CALL 40015 software roll player 2 in BASIC
2040 if peek(40016)>0 then locate #4,1,21:print#4:print#4 else locate #4,1,1:print#4,chr$(11);chr$(11);
2050 return
2060 '
*/ });
